# Copyright 2014-2021 Hewlett Packard Enterprise Development LP
command:
  k8s_vault_cluster:
    title: Kubernetes Check cray-vault Vault Cluster Status
    meta:
      desc: Kubernetes Check cray-vault Vault Cluster Status
      sev: 0
    exec: "for n in $(seq 0 2); do kubectl exec -it -n vault -c vault cray-vault-${n} -- sh -c 'export VAULT_ADDR=http://localhost:8200; vault status'; done | egrep 'Initialized|Sealed|HA Mode' | sort -u"
    stdout:
    - "/^HA Mode\\s+active$/"
    - "/^HA Mode\\s+standby$/"
    - "/^Initialized\\s+true$/"
    - "/^Sealed\\s+false$/"
    exit-status: 0